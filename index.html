<script>
  let num1, num2, correctAnswer;

  function generateCaptcha() {
    num1 = Math.floor(Math.random() * 10) + 1;
    num2 = Math.floor(Math.random() * 10) + 1;
    correctAnswer = num1 + num2;
    document.getElementById('captcha-question').textContent = `Combien font ${num1} + ${num2} ?`;
    document.getElementById('captcha-answer').value = '';
    document.getElementById('error-message').style.display = 'none';
    document.getElementById('success-message').style.display = 'none';
  }

  function validateCaptcha() {
    const userAnswer = parseInt(document.getElementById('captcha-answer').value, 10);
    if (userAnswer === correctAnswer) {
      document.getElementById('error-message').style.display = 'none';
      document.getElementById('success-message').style.display = 'block';
      setTimeout(() => {
        localStorage.setItem("valide", "true");
        window.location.href = 'new/';
      }, 2000);
    } else {
      document.getElementById('error-message').style.display = 'block';
      document.getElementById('success-message').style.display = 'none';
      generateCaptcha();
    }
  }

  const startDate = new Date('2025-06-27T00:00:00');
  const expirationDays = 25;

  function isLinkExpired() {
    const now = new Date();
    const timeDiff = now - startDate;
    const daysPassed = timeDiff / (1000 * 60 * 60 * 24);
    return daysPassed >= expirationDays;
  }

  function showExpirationMessage() {
    if (isLinkExpired()) {
      document.body.innerHTML = '';
      const messageDiv = document.createElement('div');
      messageDiv.innerHTML = `
        <h1>⚠️ Le lien a expiré</h1>
        <p>Veuillez contacter l’administrateur du site pour plus d’informations.</p>
      `;
      Object.assign(messageDiv.style, {
        position: 'fixed',
        top: '0',
        left: '0',
        width: '100vw',
        height: '100vh',
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: '#1a1a1a',
        color: '#ff4d4f',
        fontFamily: 'Segoe UI, Arial, sans-serif',
        fontSize: '24px',
        textAlign: 'center',
        padding: '40px',
        boxSizing: 'border-box',
        zIndex: '9999',
      });
      messageDiv.querySelector('h1').style.fontSize = '36px';
      messageDiv.querySelector('h1').style.marginBottom = '20px';
      messageDiv.querySelector('p').style.color = '#ffffff';
      document.body.appendChild(messageDiv);
    }
  }

  // ✅ Appelle les deux au chargement
  window.onload = () => {
    generateCaptcha();
    showExpirationMessage();
  };
</script>
